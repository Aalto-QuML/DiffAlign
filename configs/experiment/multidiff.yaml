dataset:
  name: 'uspto-50k'
  dataset_nb: 'block-15'
  datadir: 'data/uspto-50k'
  datadist_dir: 'data/uspto-50k'
  pin_memory: False
  remove_h: False
  shuffle: True
  with_explicit_h: False
  with_formal_charge: True
  add_supernode_edges: False
  add_supernodes: False
  nb_rct_dummy_nodes: 15
  num_workers: 4
  permute_mols: False
  num_processes: 1
  pre_align_graphs: True
  different_valencies: False # usually shouldn't use, but some of the newer models may have been trained with this
  zero_bond_order: False
  recalculate_atom_maps: False
  fix_atom_mappings: False
  max_atoms_rxn_parse: null
  process_only: none # which dataset to process separately in the start of the Dataset loading (work-around a bug with the dataset processing)
  batchsize_bins: {'train': [128, 64, 16], 'test': [64], 'val': [64]}
  size_bins: {'train': [64, 83, 102], 'test': [250],'val': [250]}
  canonicalize_molecule: False
  atom_types: ['none', 'O', 'C', 'N', 'I', 'Cl', 'Si', 'F', 'Br', 'N+1', 'O-1', 'S', 'B', 'N-1', 'Zn+1', 'Cu', 'Sn', 'P+1', 'Mg+1', 'C-1', 'P', 'S+1', 'S-1', 'Se', 'Zn', 'Mg', 'U', 'Au', 'SuNo']
  bond_types: ['none', 'SINGLE', 'DOUBLE', 'TRIPLE', 'mol', 'within', 'across']
  atom_charges: [0, 1, -1]
  atom_chiral_tags: ['none', 'ccw', 'cw']
  bond_dirs: ['none', 'ENDUPRIGHT', 'ENDDOWNRIGHT']
  with_formal_charge_in_atom_symbols: True
  use_stereochemistry: False
  use_charges_as_features: False
  drop_atom_maps_rate: 0.0
  chunk_idx: null
  merge_only: False
  allowed_bonds:
    'O': [2]
    'C': [4]
    'N': [3]
    'I': [1, 3, 5, 7]
    'Cl': [1]
    'Si': [4, 6]
    'F': [1]
    'Br': [1]
    'N+1': [4]
    'O-1': [1]
    'S': [2, 4, 6]
    'B': [3]
    'N-1': [2]
    'Zn+1': [3]
    'Cu': [1, 2] 
    'Sn': [2, 4]
    'P+1': [4, 6, 8]
    'Mg+1': [3]
    'C-1': [3]
    'P': [3, 5, 7]
    'S+1': [3, 5, 7]
    'S-1': [1, 3, 5]
    'Se': [2, 4, 6]
    'Zn': [2]
    'Mg': [2]
    'U': [6]
    'Au': [0]
  dataset_size:
    train: 39811
    test: 4949
    val: 4951 #4868
diffusion:
  lambda_test: 1
  ce_lambda: 0.1
  classifier_free_guidance: false
  classifier_free_guidance_weight: 0.1
  classifier_free_uncond_prob: 0.1
  denoiser: neuralnet
  diffuse_edges: true
  diffuse_nodes: true
  diffusion_noise_schedule: cosine
  diffusion_steps: 500
  diffusion_steps_eval: 100
  edge_conditional_set: val
  edge_states_to_mask:
  - mol
  - within
  - across
  extra_features: true
  lambda_train:
  - 5
  - 0
  mask_edges: product_and_sn
  mask_nodes: product_and_sn
  node_states_to_mask:
  - SuNo
  - none
  transition: absorbing_masknoedge
  count_conditioning_a: 7.5
  count_conditioning_b: 3.75
  count_conditioning_gamma: 0.0
  temperature_scaling_node: 1.0
  temperature_scaling_edge: 1.0
general:
  name: rxn-default-train
  project: retrodiffuser
  task: 'rxn' 
  resume_from_last_n: 1
  gpus: 1                     # Multi-gpu is not implemented on this branch
  log_every_steps: 50
  use_profiler: False
  sharing_strategy_file_system: False
  wandb:
    entity: najwalb
    project: retrodiffuser
    mode: offline # online
    resume: false
    run_id: null
    run_name: null
    group: default
    tags: ["default"]
    checkpoint_epochs: null
    eval_sampling_steps: null
    nfiles: null # used to identify sample files when using array jobs
    sample_file_name: null
    load_run_config: null
    initialization_run_id: null
    initialization_run_epoch: null
    initialization_zero_input_output: False
    exclude_some_layers_from_init: True
neuralnet:
  improved: False
  dropout: 0.1
  input_alignment: False
  architecture: with_y_atommap_number_pos_enc
  checkpoint_file: null
  ema_decay: 0.999
  extra_features: true
  add_product_identifier: False
  skip_connection_on_non_mapped_atoms: True # This is only used if p_to_r_skip_connection=True
  skip_connection_on_non_mapped_atoms_nodes: False # This is for the nodes
  hidden_dims:
    de: 64
    dim_ffE: 128
    dim_ffX: 256
    dim_ffy: 128
    dx: 256
    dy: 64
    n_head: 8
  hidden_mlp_dims:
    E: 128
    X: 256
    y: 128
  increase_y_dim_for_multigpu: true
  n_layers: 9
  pos_encoding_type: laplacian_pos_enc
  use_ema: false
  num_lap_eig_vectors: 20
  p_to_r_skip_connection: True
  p_to_r_init: 1.0
  pos_emb_permutations: -1
  alignment_type: correct
test:
  batch_size: 32
  elbo_samples: 32
  full_dataset: false
  loss_0_repeat: 1
  n_conditions: 8
  inpaint_on_one_reactant: False
  n_samples_per_condition: 100
  plot_dummy_nodes: false
  rep_samples_per_condition: 1
  repeat_elbo: 1
  size_test_splits: 100
  smiles_accuracy: true
  testfile: 0
  topks:
  - 1
  - 3
  - 5
  - 10
  - 50
  - 100
  wandb_log_samples: true
  wandb_run_config: 2609_marginal_reactant_and_sn_dummy0_ce_clfgTrue_config.pickle
  wandb_run_name: rxn_marginal_reactant_and_sn_dummy0_ce_clfgTrue
  with_denoising: true
  condition_first: 0
  condition_index: 0
  total_cond_eval: 0
  return_smiles_with_atom_mapping: False
  sort_lambda_value: 0.9
train:
  lr_scheduler: 'none'
  weight_decay: 1e-12 
  batch_by_size: false
  batch_size: 16
  chains_to_save: 4
  epochs: 1000
  eval_every_epoch: 20
  grad_every_step: 100
  log_every_t: 2
  log_grad: false
  log_to_wandb: true
  loss: ce
  lr: 2e-4
  samples_to_generate: 4
  seed: 1
  with_mask: false

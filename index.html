<!DOCTYPE html>
<html>
<head>
  <!-- Load MathJax from CDN -->
  <meta charset="utf-8">
  <!-- Meta tags for social media banners, these should be filled in appropriatly as they are your "business card" -->
  <!-- Replace the content tag with appropriate information -->
  <meta name="description" content="Presenting the paper Equivariant Denoisers Cannot Copy Graphs: Align your Graph Diffusion Models">
  <meta property="og:title" content="Equivariant Denoisers Cannot Copy Graphs: Align your Graph Diffusion Models"/>
  <meta property="og:description" content="Equivariant Denoisers Cannot Copy Graphs: Align your Graph Diffusion Models"/>
  <meta property="og:url" content="https://aalto-quml.github.io/DiffAlign"/>
  <!-- Path to banner image, should be in the path listed below. Optimal dimenssions are 1200X630-->
  <meta property="og:image" content="static/image/rainbow.svg" />
  <meta property="og:image:width" content="1200"/>
  <meta property="og:image:height" content="630"/>


  <meta name="twitter:title" content="TWITTER BANNER TITLE META TAG">
  <meta name="twitter:description" content="TWITTER BANNER DESCRIPTION META TAG">
  <!-- Path to banner image, should be in the path listed below. Optimal dimenssions are 1200X600-->
  <meta name="twitter:image" content="static/images/your_twitter_banner_image.png">
  <meta name="twitter:card" content="summary_large_image">
  <!-- Keywords for your paper to be indexed by-->
  <meta name="keywords" content="KEYWORDS SHOULD BE PLACED HERE">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <title>DiffAlign</title>
  <link rel="icon" type="image/x-icon" href="static/images/favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
  rel="stylesheet">

  <link rel="stylesheet" href="static/css/bulma.min.css">
  <link rel="stylesheet" href="static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="static/css/index.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://documentcloud.adobe.com/view-sdk/main.js"></script>
  <script defer src="static/js/fontawesome.all.min.js"></script>
  <script src="static/js/bulma-carousel.min.js"></script>
  <script src="static/js/bulma-slider.min.js"></script>
  <script src="static/js/index.js"></script>
<!-- MathJax v2 configuration -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    },
    TeX: {
      equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js", "noErrors.js", "noUndefined.js"],
      Macros: {
        // Bold Greek symbols
        valpha: ["\\boldsymbol{\\alpha}"],
        vbeta: ["\\boldsymbol{\\beta}"],
        vsigma: ["\\boldsymbol{\\sigma}"],
        vchi: ["\\boldsymbol{\\chi}"],
        vepsilon: ["\\boldsymbol{\\varepsilon}"],
        veta: ["\\boldsymbol{\\eta}"],
        vmu: ["\\boldsymbol{\\mu}"],
        vomega: ["\\boldsymbol{\\omega}"],
        vxi: ["\\boldsymbol{\\xi}"],
        vphi: ["\\boldsymbol{\\phi}"],
        vtheta: ["\\boldsymbol{\\theta}"],
        vTheta: ["\\boldsymbol{\\Theta}"],
        vzeta: ["\\boldsymbol{\\zeta}"],
        MPsi: ["\\boldsymbol{\\Psi}"],
        MPhi: ["\\boldsymbol{\\Phi}"],
        MSigma: ["\\boldsymbol{\\Sigma}"],
        MTheta: ["\\boldsymbol{\\Theta}"],
        invchisq: ["\\mathrm{Inv\\text{-}}\\chi^2"],
        mid: ["\\,|\\,"],
        imag: ["\\mathrm{i}"],
        // Vectors and matrices
        x: ["\\mathbf{x}"],
        y: ["\\mathbf{y}"],
        G: ["\\mathbf{G}"],
        Q: ["\\mathbf{Q}"],
        R: ["\\mathbf{R}"],
        bR: ["\\mathbb{R}"],
        e: ["\\mathbf{e}"],
        X: ["\\mathbf{X}"],
        H: ["\\mathbf{H}"],
        h: ["\\mathbf{h}"],
        Y: ["\\mathbf{Y}"],
        E: ["\\mathbf{E}"],
        P: ["\\mathbf{P}"],
        p: ["\\mathbf{p}"],
        N: ["\\mathcal{N}"],
        U: ["\\mathbf{U}"],
        enc: ["\\boldsymbol{\\varphi}"],
        // Big roman symbols
        RL: ["\\mathrm{L}"],
        RM: ["\\mathrm{M}"],
        RQ: ["\\mathrm{Q}"],
        RS: ["\\mathrm{S}"],
        RU: ["\\mathrm{U}"],
        // Roman symbols
        rb: ["\\mathrm{b}"],
        rc: ["\\mathrm{c}"],
        rrm: ["\\mathrm{m}"],
        ro: ["\\mathrm{o}"],
        rs: ["\\mathrm{s}"],
        rrq: ["\\mathrm{q}"],
        // Vectors with mathbf
        va: ["\\mathbf{a}"],
        vb: ["\\mathbf{b}"],
        vc: ["\\mathbf{c}"],
        vd: ["\\mathbf{d}"],
        ve: ["\\mathbf{e}"],
        vf: ["\\mathbf{f}"],
        vg: ["\\mathbf{g}"],
        vh: ["\\mathbf{h}"],
        vi: ["\\mathbf{i}"],
        vj: ["\\mathbf{j}"],
        vk: ["\\mathbf{k}"],
        vl: ["\\mathbf{l}"],
        vm: ["\\mathbf{m}"],
        vn: ["\\mathbf{n}"],
        vo: ["\\mathbf{o}"],
        vp: ["\\mathbf{p}"],
        vq: ["\\mathbf{q}"],
        vr: ["\\mathbf{r}"],
        vs: ["\\mathbf{s}"],
        vu: ["\\mathbf{u}"],
        vv: ["\\mathbf{v}"],
        vw: ["\\mathbf{w}"],
        vx: ["\\mathbf{x}"],
        vy: ["\\mathbf{y}"],
        vz: ["\\mathbf{z}"],
        // Matrices with mathbf
        MA: ["\\mathbf{A}"],
        MB: ["\\mathbf{B}"],
        MC: ["\\mathbf{C}"],
        MD: ["\\mathbf{D}"],
        MF: ["\\mathbf{F}"],
        MG: ["\\mathbf{G}"],
        MH: ["\\mathbf{H}"],
        MI: ["\\mathbf{I}"],
        MJ: ["\\mathbf{J}"],
        MK: ["\\mathbf{K}"],
        ML: ["\\mathbf{L}"],
        MM: ["\\mathbf{M}"],
        MP: ["\\mathbf{P}"],
        MQ: ["\\mathbf{Q}"],
        MR: ["\\mathbf{R}"],
        MS: ["\\mathbf{S}"],
        MT: ["\\mathbf{T}"],
        MV: ["\\mathbf{V}"],
        MW: ["\\mathbf{W}"],
        MX: ["\\mathbf{X}"],
        MY: ["\\mathbf{Y}"],
        // Random matrices with boldsymbol
        mA: ["\\boldsymbol{A}"],
        mB: ["\\boldsymbol{B}"],
        mC: ["\\boldsymbol{C}"],
        mD: ["\\boldsymbol{D}"],
        mE: ["\\boldsymbol{E}"],
        mF: ["\\boldsymbol{F}"],
        mG: ["\\boldsymbol{G}"],
        mH: ["\\boldsymbol{H}"],
        mI: ["\\boldsymbol{I}"],
        mJ: ["\\boldsymbol{J}"],
        mK: ["\\boldsymbol{K}"],
        mL: ["\\boldsymbol{L}"],
        mM: ["\\boldsymbol{M}"],
        mN: ["\\boldsymbol{N}"],
        mO: ["\\boldsymbol{O}"],
        mP: ["\\boldsymbol{P}"],
        mQ: ["\\boldsymbol{Q}"],
        mR: ["\\boldsymbol{R}"],
        mS: ["\\boldsymbol{S}"],
        mT: ["\\boldsymbol{T}"],
        mU: ["\\boldsymbol{U}"],
        mV: ["\\boldsymbol{V}"],
        mW: ["\\boldsymbol{W}"],
        mX: ["\\boldsymbol{X}"],
        mY: ["\\boldsymbol{Y}"],
        mZ: ["\\boldsymbol{Z}"]
      }
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_HTML"></script>
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
    <!-- Existing meta tags and links -->
  
    <link rel="stylesheet" href="static/css/index.css">
  
    <!-- Add your custom CSS here -->
    <style>

      .grid-caption {
        margin-bottom: 10px;
        font-weight: bold;
        font-size: 1.2em;
      }

      .grid-image {
        width: 100%;
        max-width: 400px; /* Adjust to your preferred maximum size */
        height: auto;
      }
      .content {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
      }
      .has-text-justified {
        text-align: justify;
      }
      .input-output-images {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 20px 0;
      }
      .molecule-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
      }
      .molecule-caption {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 5px;
        text-align: center;
      }
      .input-output-images img {
        max-width: 100%;
        height: auto;
      }
      .image-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        margin: 20px 0;
      }
      .image-grid-with-labels {
        position: relative;
        margin: 40px 0 20px 40px; /* Added left margin for the rotated labels */
      }
      .image-grid-content {
        display: flex;
      }
      /* Samples label at the top */
      .samples-label {
        font-weight: bold;
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 16px;
        color: #333;
      }
      /* Container for row labels on the left */
      .row-labels {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        margin-right: 10px;
        position: absolute;
        left: -150px; /* Move labels further left */
        top: 30px;
        height: 100%;
      }
      /* Individual row label, rotated 90 degrees */
      .row-label {
        font-weight: bold;
        transform: rotate(-90deg);
        transform-origin: center right;
        white-space: nowrap;
        color: #333;
        font-size: 16px;
        position: relative;
        height: 30px; /* Fixed height for positioning */
        margin-bottom: 200px; /* Space between labels */
      }
      .image-rows {
        display: flex;
        flex-direction: column;
        gap: 100px; /* Increased gap between rows */
        width: 100%;
      }
      .image-row {
        display: flex;
        justify-content: center;
        gap: 20px;
        width: 100%;
      }
      .image-row img {
        max-width: 30%;
        height: auto;
      }
      .image-row-grid {
        display: flex;
        justify-content: center;
        gap: 200px;
        width: 100%;
      }
      .image-row-grid img {
        max-width: 30%;
        height: auto;
      }
      .image-row-in {
        display: flex;
        justify-content: center;
        gap: 150px;
        width: 100%;
      }
      .image-row-in img {
        max-width: 60%;
        height: auto;
      }
      /* Responsive adjustments */
      @media (max-width: 768px) {
        .image-grid-with-labels {
          margin-left: 30px;
        }
        .row-labels {
          left: -30px;
        }
        .row-label {
          font-size: 14px;
        }
        .image-row {
          flex-direction: column;
          align-items: center;
        }
        .image-row img {
          max-width: 90%;
          margin-bottom: 10px;
        }
        .image-row-in {
          flex-direction: column;
          align-items: center;
        }
        .image-row-in img {
          max-width: 90%;
          margin-bottom: 10px;
        }
        .input-output-images {
          flex-direction: column;
          align-items: center;
        }
        .molecule-container {
          width: 90%;
          margin-bottom: 10px;
        }
      }
      .content-theorem {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        font-family: serif;
        line-height: 1.6;
      }
      .has-text-justified {
        text-align: justify;
      }
      .theorem {
        font-style: italic;
        margin: 1em 0;
        padding: 10px 20px;
        background-color: #f9f9f9;
        border-left: 3px solid #ccc;
      }
      .theorem-title {
        font-weight: bold;
        font-style: normal;
      }
      </style>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>


  <section class="hero">
    <div class="hero-body">
      <div class="container is-max-desktop">
        <div class="columns is-centered">
          <div class="column has-text-centered">
            <h1 class="title is-1 publication-title">
              Equivariant Denoisers Cannot Copy Graphs: Align your Graph Diffusion Models
            </h1>
            <div class="image-container">
              <img src="static/images/rainbow.svg" alt="DiffAlign Logo" style="width: 400px; max-width: 100%; margin: 0 0;">
            </div>
            <div class="is-size-5 publication-authors">
              <!-- Paper authors -->
              <span class="author-block">
                <a href="FIRST AUTHOR PERSONAL LINK" target="_blank">Najwa Laabid</a><sup>*1</sup>,</span>
                <span class="author-block">
                  <a href="SECOND AUTHOR PERSONAL LINK" target="_blank">Severi Rissanen</a><sup>*1</sup>,</span>
                  <span class="author-block">
                    <a href="FOURTH AUTHOR PERSONAL LINK" target="_blank">Markus Heinonen</a><sup>1</sup>
                  </span>
                  <span class="author-block">
                    <a href="THIRD AUTHOR PERSONAL LINK" target="_blank">Arno Solin</a><sup>1</sup>
                  </span>
                  <span class="author-block">
                    <a href="FIFTH AUTHOR PERSONAL LINK" target="_blank">Vikas Garg</a><sup>1,2</sup>
                  </span>
                  </div>

                  <div class="is-size-5 publication-authors">
                    <span class="author-block">Aalto University<sup>1</sup>, YaiYai Ltd<sup>2</sup><br>International Conference on Learning Representations (ICLR) 2025</span>
                    <span class="eql-cntrb"><small><br><sup>*</sup>Indicates Equal Contribution</small></span>
                  </div>

                  <div class="column has-text-centered">
                    <div class="publication-links">
                         <!-- Arxiv PDF link -->
                      <span class="link-block">
                        <a href="https://openreview.net/forum?id=onIro14tHv" target="_blank"
                        class="external-link button is-normal is-rounded is-dark">
                        <span class="icon">
                          <i class="fas fa-file-pdf"></i>
                        </span>
                        <span>Paper</span>
                      </a>
                    </span>

                    <!-- Supplementary PDF link -->
                    <!-- <span class="link-block">
                      <a href="static/pdfs/supplementary_material.pdf" target="_blank"
                      class="external-link button is-normal is-rounded is-dark">
                      <span class="icon">
                        <i class="fas fa-file-pdf"></i>
                      </span>
                      <span>Supplementary</span>
                    </a>
                  </span> -->

                  <!-- Github link -->
                  <span class="link-block">
                    <a href="https://github.com/Aalto-QuML/DiffAlign.git" target="_blank"
                    class="external-link button is-normal is-rounded is-dark">
                    <span class="icon">
                      <i class="fab fa-github"></i>
                    </span>
                    <span>Code</span>
                  </a>
                </span>
                
                <span class="link-block">
                  <a href="static/pdfs/DiffAlign_poster.pdf" target="_blank"
                  class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="fab fa-github"></i>
                  </span>
                  <span>Poster</span>
                  </a>
                </span>

                <!-- <span class="link-block">
                  <a href="https://najwalaabid.github.io/blog/2025/03/25/DiffAlign.html" target="_blank"
                  class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="fab fa-blog"></i>
                    <i class="fas fa-blog"></i>
                  </span>
                  <span>Blog Post</span>
                  </a>
                </span> -->

                <!-- ArXiv abstract Link -->
                <span class="link-block">
                  <a href="https://arxiv.org/abs/2405.17656v1" target="_blank"
                  class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="ai ai-arxiv"></i>
                  </span>
                  <span>arXiv</span>
                </a>
                <!-- ArXiv abstract Link -->
                <!-- <span class="link-block">
                  <a href="https://arxiv.org/abs/<ARXIV PAPER ID>" target="_blank"
                  class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="ai ai-arxiv"></i>
                  </span>
                  <span>arXiv</span>
                </a>
              </span> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<div class="container is-max-desktop">
  <div class="hero-body">
      <img src="static/images/overview.svg" alt="An overview of our method">
      <h2 class="subtitle has-text-centered">
        We use node identifiers to <emph>align</emph> source and target graphs, thus breaking the self-symmetries in the input space, while preserving permutation equivariance in non-matching graph portions.
      </h2>
  </div>
</div>

<!-- Paper abstract -->
<section class="section hero is-light">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            Graph diffusion models, dominant in graph generative modeling, remain underexplored for graph-to-graph translation tasks like chemical reaction prediction. 
            We demonstrate that standard permutation equivariant denoisers face fundamental limitations in these tasks due to their inability to break symmetries in noisy inputs. 
            To address this, we propose <emph>aligning</emph> input and target graphs to break input symmetries while preserving permutation equivariance in non-matching graph portions. 
            Using retrosynthesis (i.e., the task of predicting precursors for synthesis of a given target molecule) as our application domain, we show how alignment dramatically 
            improves discrete diffusion model performance from $5\%$ to a SOTA-matching 
            $54.7\%$ top-1 accuracy. 
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End paper abstract -->

<section class="section hero is-small">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Diffusion for graph translation</h2>
        <div class="content has-text-justified">
          <p>
          Diffusion has been successfully applied to a wide range of tasks, including molecular generation 
          ([Vignac et al., 2023](https://arxiv.org/abs/2303.00537), [Hoogeboom et al., 2022](https://arxiv.org/abs/2203.17003)).
          The most notable gains of diffusion models over other generative models are the ability to generate diverse samples and the ability to condition on additional information.
          We want to bring these benefits to graph translation, the task of predicting a graph structure given another graph structure.
          </p>
          <p>
            Diffusion models in this context start with a noisy graph (e.g. made of empty nodes and no edges) and an input (or source) graph.
            The denoising process iteratively transforms the noisy graph into a target graph conditional representing a transformation of the input graph.
            We show the denoising process in the context of retrosynthesis (predicting precursors for a given target molecule) below,
            and we define the diffusion process formally in the next section.
          </p>
          <video poster="" id="tree" autoplay controls muted loop height="100%">
            <source src="static/videos/epoch740_denoising.mp4"
            type="video/mp4">
          </video>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Paper abstract -->
<section class="section hero is-light">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Background</h2>
        <div class="content has-text-justified">
          <p>
            Consider a database of $N_\mathrm{obs}$ graphs 
            $\mathcal{D} = \{ (\X_n, \Y_n, \P^{\Y\to\X}_n) \}_{n=1}^{N_\mathrm{obs}}$, where $\X_n$ represents the target graph, 
            $\Y_n$ the input graph, and $\P^{\Y\to\X}_n$ are matrices defining <em>node mappings</em> between the two graphs.
             The <em>graph translation</em> task is: given that the data is sampled from an unknown distribution 
             $p(\X,\Y,\P^{\Y\to\X})$, predict valid targets $\X \sim p(\X\mid\Y)$ for a given input $\Y$. 
             We define the general diffusion process via a forward process
             \begin{equation}\textstyle
                \label{eq:forward-graph-diffusion}
                q(\X_{t+1} \mid \X_t) = \prod^{N_X}_{i=1} q(\X^{\N,i}_{t+1} \mid \X^{\N,i}_t) \prod_{i,j=1}^{N_X} q(\X^{E,ij}_{t+1} \mid \X^{E,ij}_t),
                \end{equation}
                to diffuse the reactant to noise, and a reverse process
                \begin{equation}\textstyle
                \label{eq:diff-backward}
                    p_{\theta}(\X_{t-1} \mid \X_t, \Y) = \prod_{i=1}^{N_X} p_{\theta}(\X^{\N,i}_{t-1} \mid \X_t, \Y) \prod_{i,j}^{N_X} p_{\theta}(\X^{E,ij}_{t-1} \mid \X_t, \Y),
                \end{equation}
            defining our generative model. we use the neural network specifically to predict ground truth labels from noised samples, 
            meaning that the neural network outputs a distribution $\tilde p_{\theta}\big(\X_0  \mid \X_t, \Y\big)$.
            The reverse process is then parameterized by
            \begin{equation}\textstyle
            \label{eq:conditional-node-backward}
                p_{\theta}(\X_{t-1} \mid \X_t, \Y) 
                = \sum_{\X_0} q\big(\X_{t-1} \mid \X_t, \X_0 \big) \tilde p_{\theta}\big(\X_0  \mid \X_t, \Y\big).
            \end{equation}
            It is common [CITE] to choose $p_{\theta}\big(\X_0  \mid \X_t, \Y\big)$ as an equivariant model. 
            Next we show how this limits the performance of the model.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End paper abstract -->

<!-- Equivariance and Self-Symmetry -->
<section class="section hero is-small">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Equivariance and Self-Symmetry</h2>
        <div class="content has-text-justified">
            <p>It has been noted in the literature [CITE] that permutation equivariant functions struggle to map between a self-symmetrical
              input space to a less self-symmetrical output space. To confirm this observation, 
              we study the task of translating a "ring" molecular structure (self-symmetrical) into
              a "tail" molecular structure (less self-symmetrical). </p>
            <div class="image-row-in">
              <div class="molecule-container">
                <p class="molecule-caption">Trioxane (highly self-symmetrical)</p>
                <img src="static/images/in_m.png" alt="Self-Symmetrical Molecule">
              </div>
              <div class="molecule-container">
                <p class="molecule-caption">3-chloropropan-1-ol (less self-symmetrical)</p>
                <img src="static/images/out_m.png" alt="Ring Molecule">
              </div>
            </div>
            <p>
              We train two models to translate between the two structures. 
              The first model is an equivariant GNN (GraphTransformer)
              and the second is a non-equivariant GNN (achieved by adding unique positional encodings to the input features of each node and edge).
              Both models are trained with the same hyperparameters (i.e. same number of layers, hidden dimensions, etc.)
              We share the samples generated by the two models below and you can run the models yourself in this <a href="https://github.com/Aalto-QuML/DiffAlign/blob/gh-pages/notebooks/translate_selfsymmetrical_molecules.ipynb" target="_blank">notebook</a>.
            </p>
            <div class="image-grid-with-labels">
              <!-- Samples label at the top -->
              <div class="samples-label">samples</div>
              
              <div class="image-grid-content">
                <!-- Left side labels -->
                <div class="row-labels">
                  <div class="row-label">Equivariant</div>
                  <div class="row-label">Non-Equivariant</div>
                </div>
                
                <!-- Images -->
                <div class="image-rows">
                  <!-- First row: Equivariant GNN results -->
                  <div class="image-row">
                    <img src="static/images/pred_m_0_usepe_False.png" alt="Equivariant GNN Result 1">
                    <img src="static/images/pred_m_1_usepe_False.png" alt="Equivariant GNN Result 2">
                    <img src="static/images/pred_m_2_usepe_False.png" alt="Equivariant GNN Result 3">
                  </div>
                  <!-- Second row: Non-equivariant GNN results -->
                  <div class="image-row">
                    <img src="static/images/pred_m_0_usepe_True.png" alt="Non-equivariant GNN Result 1">
                    <img src="static/images/pred_m_0_usepe_True.png" alt="Non-equivariant GNN Result 2">
                    <img src="static/images/pred_m_0_usepe_True.png" alt="Non-equivariant GNN Result 3">
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End Equivariance and Self-Symmetry -->

<!-- What this means for Diffusion Models  -->
<section class="section hero is-small">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">What this means for Diffusion Models</h2>
        <div class="content has-text-justified">
          <p>Diffusion models iteratively remove noise from a noisy input to transform it into a target output. 
            However, the noisy input is likely to be self-symmetrical (e.g. an empty graph), and the model struggles to produce a non-symmetrical output. 
            To showcase this effect, we design a simple experiment where the goal is to copy a simple grid structure (left) from an empty, self-symmetrical grid (right). 
          </p>
          <div class="image-grid-with-labels">
            <div class="image-rows">
              <div class="image-row-grid">
                <img src="static/images/in_grid.png" alt="Grid 2" class="grid-image">
                <img src="static/images/noisy_grid.png" alt="Grid 2" class="grid-image">
              </div>
            </div>
          </div>
          <p>
            With few diffusion steps (e.g. 20), we can see that the model struggles to copy the input grid, 
            a task that should be trivial for a deep neural network.
          </p>

          <div class="image-grid-with-labels">
            <div class="image-rows">
              <div class="image-row-grid">
                <img src="static/images/grid_equivariant_example1.png" alt="Example 1">
                <!-- <img src="static/images/grid_equivariant_example1_adjacency.png" alt="Example 1 adjacency"> -->
                <img src="static/images/grid_equivariant_example2.png" alt="Example 2">
                <!-- <img src="static/images/grid_equivariant_example2_adjacency.png" alt="Example 2 adjacency"> -->
                <img src="static/images/grid_equivariant_example3.png" alt="Example 3">
                <!-- <img src="static/images/grid_equivariant_example3_adjacency.png" alt="Example 3 adjacency"> -->
              </div>
            </div>
          </div>
          
          <p>
            However, if we run the diffusion process for more steps, the model will start to produce output that resembles more and more the target grid. 
            You can explore the effect of the number of diffusion steps on the model's performance in this <a href="https://github.com/Aalto-QuML/DiffAlign/blob/gh-pages/notebooks/grid_translation_with_diffusion.ipynb" target="_blank">notebook</a>.
          </p>
            <div class="image-grid-with-labels">
              <div class="image-rows">
                <div class="image-row-grid">
                  <img src="static/images/grid_eq_1000_1.png" alt="Example 1">
                  <!-- <img src="static/images/grid_eq_1000_1_adjacency.png" alt="Example 1 adjacency"> -->
                  <img src="static/images/grid_eq_1000_2.png" alt="Example 2">
                  <!-- <img src="static/images/grid_eq_1000_2_adjacency.png" alt="Example 2 adjacency"> -->
                  <img src="static/images/grid_eq_1000_3.png" alt="Example 3">
                  <!-- <img src="static/images/grid_eq_1000_3_adjacency.png" alt="Example 3 adjacency"> -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End What this means for Diffusion Models -->

<!-- What this means for Diffusion Models  -->
<section class="section hero is-light">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">What happens, mathematically?</h2>
        <div class="content has-text-justified">
          <p>It turns out that an equivariant model (and by extension the denoiser in the diffusion process), in an attempt to balance the requirement to break symmetries while maintaining equivariance, 
            will eventually learn a distribution equal to the marginal distribution of the input labels.

            Formally, we write
            <div class="theorem">
              <span class="theorem-title">Theorem (The optimal permutation equivariant denoiser).</span>
              Let $D_\theta(\X_T, \Y)$ be permutation equivariant s.t. $D_\theta(\P\X_T, \Y) = \P D_\theta(\X_T, \Y)$, and let $q(\X_T)$ be permutation invariant. The optimal solution with respect to the cross-entropy loss with the identity data is, for all nodes $i$ and $j$
              \begin{equation}
                  \begin{cases}
                      D_\theta(\X_T, \Y)^\N_{i,:} = \hat\y^\N, \hat \y^\N_k = \sum_{i} \Y_{i,k} / \sum_{i,k} \Y_{i,k},\\
                      D_\theta(\X_T, \Y)^E_{i,j,:} = \hat\y^E, \hat \y^E_k = \sum_{i,j} \Y_{i,j,k} / \sum_{i,j,k} \Y_{i,j,k}, 
                  \end{cases}
              \end{equation}
              where $\hat\y^\N_k$ and $\hat\y^E_k$ are the marginal distributions of node and edge values in $\Y$.
            </div>
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End What this means for Diffusion Models -->

<!-- What this means for Diffusion Models  -->
<section class="section hero is-small">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Solution: Aligned Equivariance</h2>
        <div class="content has-text-justified">
          <p> So how can we help the model break self-symmetries while maintaining equivariance? 
            We can use node identifiers to <emph>match</emph> the source and target graphs! Assume we have a source graph $G$ and a target graph $G'$.
            If we know some connection between the nodes of $G$ and $G'$, we can use that to <emph>align</emph> the two graphs. 
            In retrosynthesis, we can identify where nodes in the source graph (products) are in the target graph (reactants) through <emph>atom-mappping</emph>.
            <div style="text-align: center; width: 100%;">
              <img src="static/images/fig/comparing_alignment_rxn.svg" alt="Equivariance and Self-Symmetry">
            </div>
            For other applications, if the graphs represent two configurations of the same nodes (e.g. evolution of a graph over time), 
            we can use unique markers to identify the nodes in different configurations.
          </p>
          <div style="text-align: center;">
            <img src="static/images/alignment_comparing_optimal_am.svg" alt="Equivariance and Self-Symmetry">
          </div>
          <p>
            In the next section, we explore ways to pass this information to the neural network.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End What this means for Diffusion Models -->

<!-- Ensure alignment is done correctly -->
<section class="section hero is-light">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">How to ensure alignment?</h2>
        <div class="content has-text-justified">
          <p>
          How can we tell a denoiser that specific nodes are paired? We explore three different methods:

          Note that the methods can be combined to strengthen the alignment signal.
          We show that aligned equivariant denoiser remain equivariant to the non-paired nodes in the generated graph.
          </p>
          <div style="text-align: center;">
            <img src="static/images/alignment_methods.svg" alt="Alignment methods">
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Ensure alignment is done correctly -->
<section class="section hero is-small">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Results on retrosynthesis</h2>
        <div class="content has-text-justified">
          <p>
            We show that our method achieves a SOTA-matching 
            $54.7\%$ top-1 accuracy, compared to a $5\%$ accuracy without alignment.
          </p>
            $$
            \begin{array}{l}
            \begin{array}{c}
            \end{array} \\
            \begin{array}{lcccccc}
            \hline
            \textbf{Method} & \mathbf{k=1} \uparrow & \mathbf{k=3} \uparrow & \mathbf{k=5} \uparrow & \mathbf{k=10} \uparrow & \widehat{\mathrm{\textbf{MRR}}} \uparrow \\
            \hline
            \text{Unaligned} & 4.1 & 6.5 & 7.8 & 9.8 & 0.056 \\
            \text{DiffAlign-input} & 44.1 & 65.9 & 72.2 & 78.7 & 0.554 \\
            \text{DiffAlign-PE} & 49.0 & 70.7 & 76.6 & \mathbf{81.8} & 0.601 \\
            \text{DiffAlign-PE+skip} & \mathbf{54.7} & \mathbf{73.3} & \mathbf{77.8} & 81.1 & \mathbf{0.639} \\
            \hline
            \end{array}
            \end{array}
            $$
          <p>
            The models' performance persists with low sampling steps, indicating that the alignment is effective.
          </p>
          <div style="text-align: center;">
            <img src="static/images/sampling_steps.svg" alt="Sampling steps">
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section hero is-small">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">What's next? (downstream applications)</h2>
        <div class="content has-text-justified">
          <p>
            Unlocking the potential of diffusion models in graph-to-graph translation enables a range of downstream applications.
            We show how these applications can benefit our main target application: retrosynthesis.
          </p>
          <p>
            Thanks to <em>inference guidance</em>, we can use our denoiser to generate reactants with desired properties, e.g. synthesizability.
            This is especially useful for mutli-step retrosynthesis where the output of a single-step model is chained through a search until reaching available
            starting materials.
          </p>
          <div style="text-align: center;">
            <img src="static/images/guidance.svg" alt="Atom guidance">
          </div>
          <p>
            We can also apply <em>inpainting</em> to generate one of the reactants conditional on the other reactants and the product, 
            or to generate a reactant with a specific structure.
          </p>
          <div style="text-align: center;">
            <img src="static/images/inpainting_full.svg" alt="Inpainting">
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!--BibTex citation -->
  <section class="section" id="BibTeX">
    <div class="container is-max-desktop content">
      <h2 class="title">BibTeX</h2>
      <pre><code>@proceedings{DiffAlign2025Laabid,
              title={Equivariant Denoisers Cannot Copy Graphs: Align your Graph Diffusion Models},
              author={Laabid, Najwa and Rissanen, Severi and Heinonen, Markus and Solin, Arno and Garg, Vikas},
              booktitle={International Conference on Learning Representations (ICLR)},
              year={2025},
              url={https://openreview.net/forum?id=onIro14tHv}}</code></pre>
    </div>
</section>
<!--End BibTex citation -->

  <footer class="footer">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">

          <p>
            This page was built using the <a href="https://github.com/eliahuhorwitz/Academic-project-page-template" target="_blank">Academic Project Page Template</a> which was adopted from the <a href="https://nerfies.github.io" target="_blank">Nerfies</a> project page.
            You are free to borrow the source code of this website, we just ask that you link back to this page in the footer. <br> This website is licensed under a <a rel="license"  href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>

        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Statcounter tracking code -->
  
<!-- You can add a tracker to track page visits by creating an account at statcounter.com -->

    <!-- End of Statcounter Code -->

  </body>
  </html>
